<div class="page-content">
    <div class="row wrap">
        <div class="col-md-4">
            <form [formGroup]="dateForm">
                <div class="row">
                    <div class="col-xl-9 col-lg-9 col-md-9 col-sm-12 col-xs-12" style="padding: 0;">
                        <div class="form-group">
                            <div class="custom-label"> Allocation Date<span class='mandate'>*</span></div>
                            <p-calendar [showIcon]="true" formControlName="allocation_date"></p-calendar>
                        </div>
                    </div>
                    <div class="col-xl-3 col-lg-3 col-md-3 col-sm-12 col-xs-12" style="align-self: flex-end;">
                        <button type="button" pButton pRipple type="button" (click)='searchAreaAllocation()'
                            label="Search" class="p-button-success"></button>
                    </div>
                </div>
            </form>
        </div>
        <div class="col-md-4">
            <div class="row wrap">
                <div class="col-xl-6 col-lg-6 col-md-6 col-sm-12 col-xs-12" style="padding: 0;">
                    <div class="form-group">
                        <div class="custom-label"> Executive Name<span class='mandate'>*</span></div>
                        <p-dropdown class="custom-pdropdown" optionLabel="staff_name" optionValue="_id"
                            [formControl]="executive_id" [options]="executive_options"
                            [placeholder]="'Select Executive'">
                        </p-dropdown>
                    </div>
                </div>
                <div class="col-xl-3 col-lg-3 col-md-3 col-sm-12 col-xs-12" style="align-self: flex-end;">
                    <button type="button" pButton pRipple type="button" (click)='addCard()' label="Add"
                        class="p-button-success"></button>
                </div>
            </div>
        </div>
    </div>
    <br />
    <div class="row wrap" *ngIf="alloationForm.get('tableData')">
        <form [formGroup]="alloationForm">
            <div formArrayName="tableData" class="row wrap">
                <div *ngFor="let item of alloationForm.get('tableData').controls;let t=index;let l=last"
                    class="col-xl-6 col-lg-6 col-md-6 col-sm-2 col-xs-12" style="margin-bottom: 20px;">
                    <div class="card" formGroupName="{{t}}">
                        <div class="card-title">
                            <span>{{executiveObj[item.value.executive_id]}}</span>
                            <span>Expected Revenue: {{calculateRevenue(item.value.allocations) | currency:'INR'}}</span>
                            <i (click)='removeCard(t)' class="pi pi-times-circle icons"></i>
                        </div>
                        <div class="card-body">
                            <div class="row wrap" style="padding-bottom: 15px;">
                                <div class="col-xl-8 col-lg-8 col-md-8 col-sm-12 col-xs-12" style="padding: 0;">
                                    <p-dropdown class="custom-pdropdown" optionLabel="area" optionValue="_id"
                                        formControlName="selectedArea" [options]="areaData"
                                        [placeholder]="'Select Area'">
                                    </p-dropdown>
                                </div>
                                <div class="col-xl-4 col-lg-4 col-md-4 col-sm-12 col-xs-12"
                                    style="padding: 0;text-align: end;">
                                    <button type="button" pButton pRipple type="button" (click)='onAddArea(t, item)'
                                        label="Add" class="p-button-success addArea"></button>
                                </div>
                            </div>
                            <div>
                                <div class="area" formArrayName="allocations">
                                    <div *ngFor="let item of getAllocationCtrls(t).controls;let a=index;let b=last">
                                        <div formGroupName="{{a}}" class="chips">
                                            <span style="width: 35%;text-overflow: ellipsis;
                            overflow: hidden;">{{areaObj[item?.value?.area_id]}}</span>
                                            <div style="width: 35%;align-self: start;"
                                                [ngClass]="isFieldInvalid('product', item) ? 'custom-error' : ''">
                                                <p-dropdown class="custom-pdropdown" optionLabel="name"
                                                    optionValue="_id" formControlName="product" [options]="products"
                                                    [placeholder]="'Select Product'">
                                                </p-dropdown>
                                                <ng-container *ngIf="isVisibleErrorText('product', item)">
                                                    <div class="custom-error-text"
                                                        *ngIf="item.controls['product']?.errors?.['required']">
                                                        Product is required
                                                    </div>
                                                </ng-container>
                                            </div>
                                            <div style="width: 20%;align-self: start;"
                                                [ngClass]="isFieldInvalid('count', item) ? 'custom-error' : ''">
                                                <input style='width: 100%;margin: 0px 5px;' autocomplete="off"
                                                    type="number" id="rate" pInputText placeholder="Count"
                                                    formControlName="count">
                                                <ng-container *ngIf="isVisibleErrorText('count', item)">
                                                    <div style='margin: 0px 5px;' class="custom-error-text"
                                                        *ngIf="item.controls['count']?.errors?.['required']">
                                                        Count is required
                                                    </div>
                                                </ng-container>
                                            </div>
                                            <div style="width: 10%;text-align: center;">
                                                <i (click)='removeArea(t, a)' class="pi pi-times red-icon icons"></i>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </form>
        <br />
    </div>
    <div class="dialog-footer">
        <div style="margin-top: 20px;text-align: center;">
            <button type="button" pButton pRipple type="button" (click)='onSubmit()' label="Submit"
                class="p-button-success"></button>
            &nbsp; &nbsp;
            <button pButton pRipple label="Reset" (click)='onReset()' class="p-button-warning"></button>
        </div>
    </div>